<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pesquisa NPS Effico Saneamento</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 720px; margin: 2rem auto; padding: 0 1rem; }
    form { border: 1px solid #ddd; border-radius: 10px; padding: 20px; }
    label { display:block; margin-top: 12px; font-weight: 600; }
    .nps-scale { display: flex; justify-content: space-between; margin: 10px 0; }
    .nps-scale label { flex:1; text-align: center; font-weight: normal; }
    input[type="radio"] { margin-bottom: 5px; }
    textarea, button { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; }
    textarea { min-height: 100px; }
    button { margin-top: 16px; background: #007BFF; color: white; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
    #status { margin-top: 1rem; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Pesquisa</h1>
  <p>O NPS da Effico Saneamento mede o quanto os clientes recomendariam a empresa. É uma ferramenta simples que mostra o nível de satisfação e ajuda a melhorar os serviços e fortalecer a confiança nos projetos.</p>

  <form id="nps-form">
    <label>1. Em uma escala de 0 a 10  você indicar os serviços da Effico Saneamento?</label>
    <div class="nps-scale">
      <label>0<br><input type="radio" name="nps" value="0" required></label>
      <label>1<br><input type="radio" name="nps" value="1"></label>
      <label>2<br><input type="radio" name="nps" value="2"></label>
      <label>3<br><input type="radio" name="nps" value="3"></label>
      <label>4<br><input type="radio" name="nps" value="4"></label>
      <label>5<br><input type="radio" name="nps" value="5"></label>
      <label>6<br><input type="radio" name="nps" value="6"></label>
      <label>7<br><input type="radio" name="nps" value="7"></label>
      <label>8<br><input type="radio" name="nps" value="8"></label>
      <label>9<br><input type="radio" name="nps" value="9"></label>
      <label>10<br><input type="radio" name="nps" value="10"></label>
    </div>

    <label for="comentario">2. Espaço para deixar elogios, sugestões e criticas.</label>
    <textarea id="comentario" name="comentario"></textarea>

    <input type="hidden" id="token" name="token">
    <button type="submit">Enviar</button>
    <div id="status"></div>
  </form>

  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwoMRVNOa8o0J0NPn6HJcnUqJv_fEpnTaz71clCwkogz1L7PlFRXSpL3ZyvXyrWiQFvow/exec";

    document.addEventListener("DOMContentLoaded", () => {
      const qs = new URLSearchParams(window.location.search);
      const token = qs.get("token") || "";
      document.getElementById("token").value = token;

      const form = document.getElementById("nps-form");
      const statusBox = document.getElementById("status");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        statusBox.textContent = "Enviando...";

        const fd = new FormData(form);
        const body = new URLSearchParams();
        for (const [k,v] of fd.entries()) body.append(k,v);

        try {
          const res = await fetch(WEB_APP_URL, {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
            body: body.toString()
          });

          if (!res.ok) throw new Error("Falha no envio");

          const data = await res.json();
          if (data.ok) {
            statusBox.textContent = "Resposta registrada com sucesso para " + data.dept;
            form.reset();
          } else {
            statusBox.textContent = "Erro: " + (data.error || "Falha desconhecida");
          }
        } catch(err) {
          statusBox.textContent = "Erro ao enviar: " + err.message;
        }
      });
    });
  </script>
</body>
</html>
